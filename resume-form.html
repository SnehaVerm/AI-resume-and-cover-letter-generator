<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Resume Maker</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <style>
        /* CSS Variables for Theme */
        :root {
            /* Light Theme Variables */
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --background: #f5f5f5;
            --background-dark: #e0e0e0;
            --card-bg: #ffffff;
            --card-hover: #f5f5f5;
            --text: #333333;
            --text-light: #666666;
            --text-lighter: #888888;
            --border: #dddddd;
            --success: #4CAF50;
            --error: #f44336;
        }

        [data-theme="dark"] {
            /* Dark Theme Variables */
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --background: #121212;
            --background-dark: #0a0a0a;
            --card-bg: #1e1e1e;
            --card-hover: #2a2a2a;
            --text: #e0e0e0;
            --text-light: #b0b0b0;
            --text-lighter: #8d99ae;
            --border: #333333;
            --success: #4CAF50;
            --error: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
          max-width: 800px;
          margin: 40px auto;
          padding: 20px;
          background-color: var(--card-bg);
          border-radius: 10px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          border: 1px solid var(--border);
          transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        h1, h3 {
          text-align: center;
          color: var(--primary);
        }

        form {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .row {
          display: flex;
          gap: 20px;
          flex-wrap: wrap;
        }

        .form-group {
          flex: 1;
          display: flex;
          flex-direction: column;
        }

        label {
          margin-bottom: 6px;
          font-weight: bold;
          color: var(--text);
        }

        input, textarea {
          padding: 10px;
          border: 1px solid var(--border);
          border-radius: 6px;
          background-color: var(--card-bg);
          color: var(--text);
          transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        input:focus, textarea:focus {
          outline: 2px solid var(--accent);
        }

        button {
          margin-top: 10px;
          padding: 10px;
          background-color: var(--primary);
          border: none;
          color: #fff;
          border-radius: 6px;
          cursor: pointer;
          transition: 0.2s;
        }

        button:hover {
          background-color: var(--secondary);
        }

        .remove-btn {
          background-color: #f72585;
          margin-left: 10px;
        }

        .remove-btn:hover {
          background-color: #c1121f;
        }

        .submit-btn {
          background-color: var(--primary);
          font-weight: bold;
        }

        /* Resume Preview Styles */
        #resumePreview {
          display: none;
          max-width: 800px;
          margin: 40px auto;
          padding: 30px;
          background-color: var(--card-bg);
          border-radius: 10px;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
          color: var(--text);
          line-height: 1.6;
          border: 1px solid var(--border);
          transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        #resumePreview header h1 {
          margin: 0;
          font-size: 2.5em;
          border-bottom: none;
          color: var(--primary);

        }

        #resumePreview header h2 {
          margin: 0;
          font-size: 1.2em;
          color: var(--accent);
          text-align: center;
          
        }

        #resumePreview .contact {
          margin-top: 10px;
          font-size: 0.95em;
          display: flex;
          justify-content: center;
          gap: 20px;
          flex-wrap: wrap;
          color: var(--text-light);
        }

        #resumePreview .links {
          margin-top: 10px;
          font-size: 0.95em;
          display: flex;
         justify-content: first baseline; 
          gap: 20px;
          flex-wrap: wrap;
        }

        #resumePreview .links a {
          color: var(--primary);
          text-decoration: none;
          display: flex;
          align-items: center;
          gap: 5px;
          max-width: 300px;
          word-break: break-all;
        }

        #resumePreview .links a:hover {
          text-decoration: underline;
        }

        #resumePreview section {
          margin-bottom: 30px;
        }

        #resumePreview section h3 {
          font-size: 1.3em;
          color: var(--accent);
          border-bottom: 2px solid var(--accent);
          padding-bottom: 8px;
          margin-bottom: 15px;
          text-align: left;
        }

        #resumePreview .item {
          margin-bottom: 20px;
        }

        #resumePreview .title {
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          color: var(--text);
        }

        #resumePreview .org a {
          text-decoration: none;
          color: var(--primary);
          font-weight: normal;
        }

        #resumePreview .org a:hover {
          text-decoration: underline;
        }

        #resumePreview .tags {
          color: var(--accent);
          font-style: italic;
          margin: 5px 0;
        }

        #resumePreview .view-link {
          color: var(--primary);
          text-decoration: none;
          font-size: 0.9em;
          display: flex;
          align-items: center;
          gap: 5px;
        }

        #resumePreview .view-link:hover {
          text-decoration: underline;
        }

        #resumePreview .skills {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        }

        #resumePreview .skills span {
          background-color: rgba(67, 97, 238, 0.1);
          color: var(--primary);
          padding: 6px 12px;
          border-radius: 20px;
          font-size: 0.9em;
          border: 1px solid var(--border);
        }

        #resumePreview .interest {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        }

        #resumePreview .interest span {
          background-color: rgba(72, 149, 239, 0.1);
          color: var(--accent);
          padding: 6px 12px;
          border-radius: 20px;
          font-size: 0.9em;
          border: 1px solid var(--border);
        }

        .export-buttons {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 20px;
        }

        .export-buttons button {
          padding: 10px 20px;
        }

        .back-btn {
          background-color: #6c757d;
        }
        
        .back-btn:hover {
          background-color: #5a6268;
        }

        .download-btn {
          background-color: var(--success);
        }
        
        .download-btn:hover {
          background-color: #3d9140;
        }
        
        .another-generate-btn {
          background-color: var(--primary);
        }
        
        .another-generate-btn:hover {
          background-color: var(--secondary);
        }
        
        /* Fix for languages and interests sections */
        .section-container {
          width: 100%;
        }
        
        .section-container > h3 {
          width: 100%;
        }
        
        .section-row {
          display: flex;
          gap: 20px;
          flex-wrap: wrap;
        }
        
        .section-column {
          flex: 1;
          min-width: 300px;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border: none;
            font-size: 1.2rem;
            transition: background-color 0.3s ease;
        }
    </style>
  
  <div class="container">
    <h1><i class="fas fa-robot"></i>AI Resume Form</h1>

    <form id="resumeForm">
      <div class="row">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="fullName" placeholder="John Doe" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" placeholder="john.doe@example.com" required />
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label>Phone Number</label>
          <input type="text" id="phone" placeholder="+1234567890" required />
        </div>
        <div class="form-group">
          <label>Location</label>
          <input type="text" id="location" placeholder="San Francisco, CA" required />
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label>LinkedIn</label>
          <input type="url" id="linkedin" placeholder="https://linkedin.com/in/..." />
        </div>
        <div class="form-group">
          <label>GitHub</label>
          <input type="url" id="github" placeholder="https://github.com/..." />
        </div>
      </div>

      <div class="form-group">
        <label>Portfolio</label>
        <input type="url" id="portfolio" placeholder="https://yourportfolio.com" />
      </div>

      <div class="form-group">
        <label>Summary</label>
        <textarea rows="3" id="summary" placeholder="Brief professional summary..." required></textarea>
      </div>

      <div class="section-container">
        <h3>Work Experience</h3>
        <div id="experience-section">
          <button type="button" onclick="addExperience()"><i class="fas fa-plus"></i> Add Experience</button>
        </div>
      </div>

      <div class="section-container">
        <h3>Education</h3>
        <div id="education-section">
          <button type="button" onclick="addEducation()"><i class="fas fa-plus"></i> Add Education</button>
        </div>
      </div>

      <div class="section-container">
        <h3>Skills</h3>
        <div id="skills-section">
          <button type="button" onclick="addSkill()"><i class="fas fa-plus"></i> Add Skill</button>
        </div>
      </div>

      <div class="section-container">
        <h3>Projects</h3>
        <div id="projects-section">
          <button type="button" onclick="addProject()"><i class="fas fa-plus"></i> Add Project</button>
        </div>
      </div>

      <div class="section-container">
        <h3>Languages & Interests</h3>
        <div class="section-row">
          <div class="section-column" id="languages-section">
            <h4>Languages</h4>
            <button type="button" onclick="addLanguage()"><i class="fas fa-plus"></i> Add Language</button>
          </div>

          <div class="section-column" id="interests-section">
            <h4>Interests</h4>
            <button type="button" onclick="addInterest()"><i class="fas fa-plus"></i> Add Interest</button>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn">Submit</button>
    </form>
  </div>

  <div id="resumePreview">
  </div>

  <button class="theme-toggle" id="themeToggle">
    <i class="fas fa-sun"></i>
  </button>

  <script>
    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // Initialize theme from localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'light' || (!savedTheme && !prefersDark)) {
            setLightTheme();
        } else {
            setDarkTheme();
        }
    }

    function setDarkTheme() {
        body.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
    }

    function setLightTheme() {
        body.removeAttribute('data-theme');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
    }

    // Toggle theme
    themeToggle.addEventListener('click', () => {
        if (body.getAttribute('data-theme') === 'dark') {
            setLightTheme();
        } else {
            setDarkTheme();
        }
    });

    // Initialize theme on page load
    initTheme();
  
    // Function to parse URL parameters and extract resume data
    function parseResumeDataFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const resumeData = {};
      
      for (const [key, value] of urlParams.entries()) {
        try {
          // Try to parse as JSON first
          resumeData[key] = JSON.parse(decodeURIComponent(value));
        } catch (e) {
          // If parsing fails, use the value as is
          resumeData[key] = decodeURIComponent(value);
        }
      }
      
      return resumeData;
    }
    
    // Function to populate form with resume data
    function populateFormWithResumeData(resumeData) {
      console.log("Populating form with data:", resumeData);
      
      // Basic information
      if (resumeData.fullName) document.getElementById('fullName').value = resumeData.fullName;
      if (resumeData.email) document.getElementById('email').value = resumeData.email;
      if (resumeData.phone) document.getElementById('phone').value = resumeData.phone;
      if (resumeData.location) document.getElementById('location').value = resumeData.location;
      if (resumeData.linkedin) document.getElementById('linkedin').value = resumeData.linkedin;
      if (resumeData.github) document.getElementById('github').value = resumeData.github;
      if (resumeData.portfolio) document.getElementById('portfolio').value = resumeData.portfolio;
      if (resumeData.summary) document.getElementById('summary').value = resumeData.summary;
      
      // Skills
      if (resumeData.skills && Array.isArray(resumeData.skills)) {
        // Clear any existing skill inputs
        const skillInputs = document.querySelectorAll('#skills-section .skill-row');
        skillInputs.forEach(input => input.remove());
        
        // Add skills from resume data
        resumeData.skills.forEach(skill => {
          addSkill();
          const skillRows = document.querySelectorAll('#skills-section .skill-row');
          const lastSkillRow = skillRows[skillRows.length - 1];
          lastSkillRow.querySelector('.skill-name').value = skill.name || '';
          lastSkillRow.querySelector('.skill-level').value = skill.level || '';
        });
      }
      
      // Projects
      if (resumeData.projects && Array.isArray(resumeData.projects)) {
        // Clear any existing project inputs
        const projectInputs = document.querySelectorAll('#projects-section .project-item');
        projectInputs.forEach(input => input.remove());
        
        // Add projects from resume data
        resumeData.projects.forEach(project => {
          addProject();
          const projectItems = document.querySelectorAll('#projects-section .project-item');
          const lastProjectItem = projectItems[projectItems.length - 1];
          lastProjectItem.querySelector('.project-name').value = project.name || '';
          lastProjectItem.querySelector('.project-desc').value = project.description || '';
          lastProjectItem.querySelector('.project-tech').value = project.technologies || '';
          lastProjectItem.querySelector('.project-link').value = project.link || '';
        });
      }
      
      // Languages
      if (resumeData.languages && Array.isArray(resumeData.languages)) {
        // Clear any existing language inputs
        const languageInputs = document.querySelectorAll('#languages-section .language-item');
        languageInputs.forEach(input => input.remove());
        
        // Add languages from resume data
        resumeData.languages.forEach(language => {
          addLanguage();
          const languageItems = document.querySelectorAll('#languages-section .language-item');
          const lastLanguageItem = languageItems[languageItems.length - 1];
          lastLanguageItem.querySelector('.language-name').value = language.name || '';
          lastLanguageItem.querySelector('.language-level').value = language.proficiency || language.level || '';
        });
      }
      
      // Interests
      if (resumeData.interests && Array.isArray(resumeData.interests)) {
        // Clear any existing interest inputs
        const interestInputs = document.querySelectorAll('#interests-section .interest-item');
        interestInputs.forEach(input => input.remove());
        
        // Add interests from resume data
        resumeData.interests.forEach(interest => {
          addInterest();
          const interestItems = document.querySelectorAll('#interests-section .interest-item');
          const lastInterestItem = interestItems[interestItems.length - 1];
          lastInterestItem.querySelector('.interest-name').value = interest;
        });
      }

      // Education
      if (resumeData.education && Array.isArray(resumeData.education)) {
        // Clear any existing education inputs
        const educationInputs = document.querySelectorAll('#education-section .education-item');
        educationInputs.forEach(input => input.remove());
        
        // Add education from resume data
        resumeData.education.forEach(edu => {
          addEducation();
          const educationItems = document.querySelectorAll('#education-section .education-item');
          const lastEducationItem = educationItems[educationItems.length - 1];
          lastEducationItem.querySelector('.education-degree').value = edu.degree || '';
          lastEducationItem.querySelector('.education-school').value = edu.school || '';
          lastEducationItem.querySelector('.education-duration').value = edu.duration || '';
          lastEducationItem.querySelector('.education-desc').value = edu.description || '';
        });
      }

      // Experience
      if (resumeData.experience && Array.isArray(resumeData.experience)) {
        // Clear any existing experience inputs
        const experienceInputs = document.querySelectorAll('#experience-section .experience-item');
        experienceInputs.forEach(input => input.remove());
        
        // Add experience from resume data
        resumeData.experience.forEach(exp => {
          addExperience();
          const experienceItems = document.querySelectorAll('#experience-section .experience-item');
          const lastExperienceItem = experienceItems[experienceItems.length - 1];
          lastExperienceItem.querySelector('.experience-title').value = exp.title || '';
          lastExperienceItem.querySelector('.experience-company').value = exp.company || '';
          lastExperienceItem.querySelector('.experience-duration').value = exp.duration || '';
          lastExperienceItem.querySelector('.experience-desc').value = exp.description || '';
        });
      }
    }
    
    // Parse URL and populate form when page loads
    document.addEventListener('DOMContentLoaded', function() {
      const resumeData = parseResumeDataFromURL();
      console.log("Resume data from URL:", resumeData);
      
      if (Object.keys(resumeData).length > 0) {
        populateFormWithResumeData(resumeData);
      }
    });

    // Form field functions
    function addSkill() {
      const section = document.getElementById('skills-section');
      const div = document.createElement('div');
      div.className = 'row skill-row';
      div.innerHTML = `
        <div class="form-group">
          <input type="text" placeholder="Skill Name" class="skill-name" />
        </div>
        <div class="form-group">
          <input type="text" placeholder="Beginner/Advanced" class="skill-level" />
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove</button>
      `;
      // Insert before the "Add Skill" button
      section.insertBefore(div, section.lastElementChild);
    }

    function addExperience() {
      const section = document.getElementById('experience-section');
      const div = document.createElement('div');
      div.className = 'experience-item';
      div.innerHTML = `
        <div class="form-group">
          <label>Job Title</label>
          <input type="text" placeholder="e.g., Software Engineer" class="experience-title" />
        </div>
        <div class="row">
          <div class="form-group">
            <label>Company</label>
            <input type="text" placeholder="Company Name" class="experience-company" />
          </div>
          <div class="form-group">
            <label>Duration</label>
            <input type="text" placeholder="e.g., Jan 2023 - Present" class="experience-duration" />
          </div>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea rows="3" placeholder="Describe your responsibilities and achievements..." class="experience-desc"></textarea>
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove Experience</button>
      `;
      // Insert before the "Add Experience" button
      section.insertBefore(div, section.lastElementChild);
    }

    function addEducation() {
      const section = document.getElementById('education-section');
      const div = document.createElement('div');
      div.className = 'education-item';
      div.innerHTML = `
        <div class="form-group">
          <label>Degree</label>
          <input type="text" placeholder="e.g., Bachelor of Science in Computer Science" class="education-degree" />
        </div>
        <div class="row">
          <div class="form-group">
            <label>School/University</label>
            <input type="text" placeholder="University Name" class="education-school" />
          </div>
          <div class="form-group">
            <label>Duration</label>
            <input type="text" placeholder="e.g., Sep 2019 - May 2023" class="education-duration" />
          </div>
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea rows="2" placeholder="Relevant coursework, thesis, achievements..." class="education-desc"></textarea>
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove Education</button>
      `;
      // Insert before the "Add Education" button
      section.insertBefore(div, section.lastElementChild);
    }

    function addProject() {
      const section = document.getElementById('projects-section');
      const div = document.createElement('div');
      div.className = 'project-item';
      div.innerHTML = `
        <div class="form-group">
          <label>Project Name</label>
          <input type="text" placeholder="Project Name" class="project-name" />
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea rows="2" placeholder="Project description..." class="project-desc"></textarea>
        </div>
        <div class="form-group">
          <label>Technologies</label>
          <input type="text" placeholder="React, Node.js, etc." class="project-tech" />
        </div>
        <div class="form-group">
          <label>Link</label>
          <input type="url" placeholder="Project URL" class="project-link" />
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove Project</button>
      `;
      // Insert before the "Add Project" button
      section.insertBefore(div, section.lastElementChild);
    }

    function addLanguage() {
      const section = document.getElementById('languages-section');
      const div = document.createElement('div');
      div.className = 'language-item';
      div.innerHTML = `
        <div class="form-group">
          <input type="text" placeholder="e.g., English" class="language-name" />
        </div>
        <div class="form-group">
          <input type="text" placeholder="e.g., Fluent" class="language-level" />
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove Language</button>
      `;
      // Insert before the "Add Language" button
      section.insertBefore(div, section.lastElementChild);
    }

    function addInterest() {
      const section = document.getElementById('interests-section');
      const div = document.createElement('div');
      div.className = 'interest-item';
      div.innerHTML = `
        <div class="form-group">
          <input type="text" placeholder="e.g., Cloud Computing" class="interest-name" />
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i> Remove Interest</button>
      `;
      // Insert before the "Add Interest" button
      section.insertBefore(div, section.lastElementChild);
    }

    // Form submission and resume generation
    document.getElementById('resumeForm').addEventListener('submit', function(e) {
      e.preventDefault();
      generateResume();
    });

    function generateResume() {
      // Get form values
      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const location = document.getElementById('location').value;
      const linkedin = document.getElementById('linkedin').value;
      const github = document.getElementById('github').value;
      const portfolio = document.getElementById('portfolio').value;
      const summary = document.getElementById('summary').value;

      // Get skills
      const skillElements = document.querySelectorAll('.skill-name');
      const levelElements = document.querySelectorAll('.skill-level');
      const skills = [];
      for (let i = 0; i < skillElements.length; i++) {
        if (skillElements[i].value.trim() !== '') {
          skills.push({
            name: skillElements[i].value,
            level: levelElements[i].value
          });
        }
      }

      // Get projects
      const projectItems = document.querySelectorAll('.project-item');
      const projects = [];
      projectItems.forEach(item => {
        const name = item.querySelector('.project-name').value;
        const desc = item.querySelector('.project-desc').value;
        const tech = item.querySelector('.project-tech').value;
        const link = item.querySelector('.project-link').value;
        
        if (name.trim() !== '') {
          projects.push({
            name,
            desc,
            tech,
            link
          });
        }
      });

      // Get languages
      const languageItems = document.querySelectorAll('.language-item');
      const languages = [];
      languageItems.forEach(item => {
        const name = item.querySelector('.language-name').value;
        const level = item.querySelector('.language-level').value;
        
        if (name.trim() !== '') {
          languages.push({
            name,
            level
          });
        }
      });

      // Get interests
      const interestItems = document.querySelectorAll('.interest-item');
      const interests = [];
      interestItems.forEach(item => {
        const name = item.querySelector('.interest-name').value;
        
        if (name.trim() !== '') {
          interests.push(name);
        }
      });

      // Get education
      const educationItems = document.querySelectorAll('.education-item');
      const education = [];
      educationItems.forEach(item => {
        const degree = item.querySelector('.education-degree').value;
        const school = item.querySelector('.education-school').value;
        const duration = item.querySelector('.education-duration').value;
        const desc = item.querySelector('.education-desc').value;
        
        if (degree.trim() !== '') {
          education.push({
            degree,
            school,
            duration,
            desc
          });
        }
      });

      // Get experience
      const experienceItems = document.querySelectorAll('.experience-item');
      const experience = [];
      experienceItems.forEach(item => {
        const title = item.querySelector('.experience-title').value;
        const company = item.querySelector('.experience-company').value;
        const duration = item.querySelector('.experience-duration').value;
        const desc = item.querySelector('.experience-desc').value;
        
        if (title.trim() !== '') {
          experience.push({
            title,
            company,
            duration,
            desc
          });
        }
      });

      // Generate resume HTML
      let resumeHTML = `
        <div class="resume-container" id="resumeContent">
          <header>
            <h1>${fullName}</h1>
            <div class="contact">
              <span><i class="fas fa-envelope"></i> ${email}</span>
              <span><i class="fas fa-phone"></i> ${phone}</span>
              <span><i class="fas fa-map-marker-alt"></i> ${location}</span>
            </div>
      `;

      // Add links section with icons and full URLs
      let linksHTML = '';
      if (linkedin || github || portfolio) {
        linksHTML = '<div class="links">';
        
        if (linkedin) {
          linksHTML += `<a href="${linkedin}" target="_blank"><i class="fab fa-linkedin"></i> ${linkedin}</a>`;
        }
        
        if (github) {
          linksHTML += `<a href="${github}" target="_blank"><i class="fab fa-github"></i> ${github}</a>`;
        }
        
        if (portfolio) {
          linksHTML += `<a href="${portfolio}" target="_blank"><i class="fas fa-globe"></i> ${portfolio}</a>`;
        }
        
        linksHTML += '</div>';
      }
      
      resumeHTML += linksHTML + '</header>';

      // Add summary section
      resumeHTML += `
          <section>
            <h3>Summary</h3>
            <p>${summary}</p>
          </section>
      `;

      // Add work experience section
      if (experience.length > 0) {
        resumeHTML += `
          <section>
            <h3>Work Experience</h3>
        `;
        
        experience.forEach(exp => {
          resumeHTML += `
            <div class="item">
              <div class="title">
                <strong>${exp.title}</strong>
                ${exp.duration ? `<span>${exp.duration}</span>` : ''}
              </div>
              ${exp.company ? `<p class="org">${exp.company}</p>` : ''}
              ${exp.desc ? `<p>${exp.desc}</p>` : ''}
            </div>
          `;
        });
        
        resumeHTML += `</section>`;
      }

      // Add education section
      if (education.length > 0) {
        resumeHTML += `
          <section>
            <h3>Education</h3>
        `;
        
        education.forEach(edu => {
          resumeHTML += `
            <div class="item">
              <div class="title">
                <strong>${edu.degree}</strong>
                ${edu.duration ? `<span>${edu.duration}</span>` : ''}
              </div>
              ${edu.school ? `<p class="org">${edu.school}</p>` : ''}
              ${edu.desc ? `<p>${edu.desc}</p>` : ''}
            </div>
          `;
        });
        
        resumeHTML += `</section>`;
      }

      // Add projects section
      if (projects.length > 0) {
        resumeHTML += `
          <section>
            <h3>Projects</h3>
        `;
        
        projects.forEach(project => {
          resumeHTML += `
            <div class="item">
              <div class="title">
                <strong>${project.name}</strong>
                ${project.link ? `<a href="${project.link}" class="view-link" target="_blank"><i class="fas fa-external-link-alt"></i> ${project.link}</a>` : ''}
              </div>
              ${project.tech ? `<p class="tags">${project.tech}</p>` : ''}
              ${project.desc ? `<p>${project.desc}</p>` : ''}
            </div>
          `;
        });
        
        resumeHTML += `</section>`;
      }

      // Add skills section
      if (skills.length > 0) {
        resumeHTML += `
          <section>
            <h3>Skills</h3>
            <div class="skills">
        `;
        
        skills.forEach(skill => {
          resumeHTML += `<span>${skill.name}${skill.level ? ` (${skill.level})` : ''}</span>`;
        });
        
        resumeHTML += `
            </div>
          </section>
        `;
      }

      // Add languages section
      if (languages.length > 0) {
        resumeHTML += `
          <section>
            <h3>Languages</h3>
            <div class="skills">
        `;
        
        languages.forEach(language => {
          resumeHTML += `<span>${language.name}${language.level ? ` (${language.level})` : ''}</span>`;
        });
        
        resumeHTML += `
            </div>
          </section>
        `;
      }

      // Add interests section
      if (interests.length > 0) {
        resumeHTML += `
          <section>
            <h3>Interests</h3>
            <div class="interest">
        `;
        
        interests.forEach(interest => {
          resumeHTML += `<span>${interest}</span>`;
        });
        
        resumeHTML += `
            </div>
          </section>
        `;
      }

      resumeHTML += `</div>`;

      // Display the resume
      const resumePreview = document.getElementById('resumePreview');
      resumePreview.innerHTML = resumeHTML;
      resumePreview.style.display = 'block';
      document.querySelector('.container').style.display = 'none';

      // Add export buttons
      const exportButtons = document.createElement('div');
      exportButtons.className = 'export-buttons';
      exportButtons.innerHTML = `
        <button class="back-btn" onclick="backToForm()"><i class="fas fa-arrow-left"></i> Back to Form</button>
        <button class="another-generate-btn" onclick="anotherGenerate()"><i class="fas fa-sync"></i> Another Generate</button>
        <button class="download-btn" onclick="downloadResume()"><i class="fas fa-download"></i> Download as PDF</button>
      `;
      resumePreview.appendChild(exportButtons);

      // Scroll to resume
      resumePreview.scrollIntoView({ behavior: 'smooth' });
    }

    function backToForm() {
      document.getElementById('resumePreview').style.display = 'none';
      document.querySelector('.container').style.display = 'block';
      document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
    }

    function anotherGenerate() {
      document.getElementById('resumePreview').style.display = 'none';
      document.querySelector('.container').style.display = 'block';
      document.getElementById('resumeForm').reset();
      document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
    }
    
    function downloadResume() {
        const contentElement = document.getElementById("resumeContent");
        const previewContainer = document.getElementById("resumePreview");
        const { jsPDF } = window.jspdf;

        // Get the actual computed background color of the resume card
        const resumeBackgroundColor = getComputedStyle(previewContainer).backgroundColor;

        const options = {
            quality: 1.0,
            backgroundColor: resumeBackgroundColor, 
            pixelRatio: 2 
        };

        htmlToImage.toPng(contentElement, options)
            .then((dataUrl) => {
                const pdf = new jsPDF({
                    orientation: "p",
                    unit: "mm",
                    format: "a4"
                });

                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // Set the color for the entire PDF canvas
                pdf.setFillColor(resumeBackgroundColor);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                const margin = 10;
                const contentWidth = pageWidth - (margin * 2);
                const contentHeight = pageHeight - (margin * 2);

                const img = new Image();
                img.src = dataUrl;
                
                img.onload = function () {
                    const aspectRatio = this.width / this.height;

                    let pdfImgWidth = contentWidth;
                    let pdfImgHeight = pdfImgWidth / aspectRatio;

                    if (pdfImgHeight > contentHeight) {
                        pdfImgHeight = contentHeight;
                        pdfImgWidth = pdfImgHeight * aspectRatio;
                    }

                    const x = (pageWidth - pdfImgWidth) / 2;
                    const y = (pageHeight - pdfImgHeight) / 2;

                    pdf.addImage(dataUrl, "PNG", x, y, pdfImgWidth, pdfImgHeight);
                    pdf.save("resume.pdf");
                };

                // Ensure onload runs even if the image is cached
                if (img.complete) {
                    img.onload();
                }
            })
            .catch((error) => {
                console.error('Oops, something went wrong!', error);
            });
    }

  </script>

</body>
</html>
